<script>
  var formatter = new Intl.NumberFormat('en-US', {
    style: 'currency',
    currency: 'USD',
    maximumFractionDigits: 0, // (causes 2500.99 to be printed as $2,501)
  });
  
Webflow.push(function() {  

  let queryString = window.location.search;
  console.log('Got this queryString ' + queryString)
  let params = new URLSearchParams(queryString);
  console.log('Got these params ' + params)
  let address = params.get("address"); // is the number 123
  console.log('Pulled address from queryString: ' + address);

  let addressDisplay = document.getElementById("address-display");
  addressDisplay.innerHTML = address;
	
  let apiUrl = "https://y9lns0og13.execute-api.us-east-1.amazonaws.com/prod/value/";
  apiUrl += address;
  console.log("generated this url " + apiUrl);
  
  $(document).ready(function () {
  
    let offerHeader = document.getElementById("offer-header");
    let estimateDisplay = document.getElementById("estimate");
    let estimateMinDisplay = document.getElementById("estimate-min");
    let estimateMaxDisplay = document.getElementById("estimate-max");
    let confidenceDisplay = document.getElementById("confidence-score");
    let offerDisplay = document.getElementById("offer-estimate");   
    let offerExplanation = document.getElementById("offer-explanation"); 
    let scheduleWalkthrough = document.getElementById("schedule-walkthrough");           
    
    $.ajax({
      url: apiUrl,
      method: 'GET',
    }).done(function (result) {
      $("#address").html(address);
      console.log(result);      
      try {
        let estimatedValue = result.EstimatedValue;
        let estimatedMinValue = result.EstimatedMinValue;
        let estimatedMaxValue = result.EstimatedMaxValue;
        let confidenceScore = result.ConfidenceScore;
        let storiesCount = result.StoriesCount;
        let bedroomsCount = result.BedroomsCount;
        let bathroomsCount = result.BathroomsCount;
        let areaBuilding = result.AreaBuilding;
        let areaLotAcres = result.AreaLotAcres;
        let yearBuilt = result.YearBuilt;
        let pool = result.Pool;
        let poolArea = result.PoolArea;             
        
        console.log('Got estimate of ' + estimatedValue);
        console.log('Got bedrooms ' + bedroomsCount);        
        console.log('Got baths ' + bathroomsCount);
        console.log('Got year built ' + yearBuilt);      
        console.log('Got pool ' + pool);
        
        if (estimatedValue === "$0" || estimatedValue === "$NaN" || typeof estimatedValue === "undefined") {
          throw 'Unable to pull value estimate';
        } else {          
        	let offerEstimate = estimatedValue - (estimatedValue * 0.02);
          offerDisplay.innerHTML = formatter.format(offerEstimate);					                    
        	estimateDisplay.innerHTML = formatter.format(estimatedValue);
        	estimateMinDisplay.innerHTML = formatter.format(estimatedMinValue);
        	estimateMaxDisplay.innerHTML = formatter.format(estimatedMaxValue);          
					confidenceDisplay.innerHTML = confidenceScore;
        }
        
      } catch (error) {
        console.log(error);
        offerHeader.innerHTML = "We were unable to pull your value report";
        offerDisplay.innerHTML = "$-";					                    
        estimateDisplay.innerHTML = "$-";
        estimateMinDisplay.innerHTML = "$-";
        estimateMaxDisplay.innerHTML = "$-";          
        confidenceDisplay.innerHTML = "0";
		    offerExplanation.style.display = "none";        
	      scheduleWalkthrough.style.display = "none";                
      }
    }).fail(function (err) {
      console.log('Unabled to pull home value estimate');
      console.log(err);
      offerHeader.innerHTML = "We were unable to pull your value report";      
      offerDisplay.innerHTML = "$-";					                    		                    
      estimateDisplay.innerHTML = "$-";
      estimateMinDisplay.innerHTML = "$-";
      estimateMaxDisplay.innerHTML = "$-";          
      confidenceDisplay.innerHTML = "0";
      offerExplanation.style.display = "none";  
      scheduleWalkthrough.style.display = "none";        
    });
  });
});  
</script>